# プロジェクト案：JET-PALLETforEORZER

## 1. プロジェクト概要
- **目的**: FF14 TTRPGのオンラインセッションにおける、リソース管理とアクション処理の自動化。BCdiceでダイスロールするためのコマンドを生成し、ダイスロール自体は外部で行う。
- **ベースUI**: JET-PALLET形式（キャラクターシート＋実行ボタンの構成）
- **ターゲット**: GMおよびプレイヤー

### レファレンス
- **基幹システム**：JET-PALLET[https://github.com/YYTKD/JET-PALLET]
- **データレファレンス**：GMルールブック[https://gdl.square-enix.com/ffxivttrpg/JP_GM20240523.pdf]、PLルールブック[https://gdl.square-enix.com/ffxivttrpg/JP_PL20240523.pdf]、サンプルキャラクターシート[https://gdl.square-enix.com/ffxivttrpg/character_sheet_Lv30JP_web0801.pdf]、サンプルキャラクターシート⓶[https://gdl.square-enix.com/ffxivttrpg/DLC_character_sheet_BardJP.pdf]

## 2. 技術スタック
- **Frontend**: HTML/CSS/JavaScript

## 3. コア・データ構造 (Schema)
AIがオブジェクトのプロパティを推測しやすくするために定義します。

### Character Object
- `name`: 名前
- `job`: ジョブ名 (戦士, 吟遊詩人, etc.)
- `resources`: { HP, maxHP, MP, maxMP, （ユーザーが設定した特性リソース） }
- `mainStat`：判定に使用するステータス。STR,DEX,INT,MNDから選択する。具体的な数字は入力する。
- `buffs`: [ { id, name, duration, effectValue } ]
- `comboStep`: 現在のコンボ待機状態 (例: "none", "heavy_swing")

### Action (Macro) Object
- `name`: アビリティ名
- `type`: "メイン", "サブ", "インスタント","その他"
- `tag`："物理","魔法","連射","メイン","サブ","風属性",etc.
- `cost`: { MP, （ユーザーが登録した特性リソース） }、特定のバフを得ていることが使用の条件になっている場合、実質的にコストにもなる。
- `judge`："d20+{mainStat}"という形でBCdiceに使用できるコマンドにする。ない場合もある。
- `stack`：使用可能な回数。任意の整数の値を取る。0の場合は回数制限なし。指定されたタイミングで上限まで回復する。
- `logic`: 
  - `damage`: 基本ダメージ。ない場合もある。
  - `damageDH`：　ダイレクトヒット時の追加ダメージ
  - `applyBuff`: 付与するバフID。バフを付与しない場合もある。
  - `requireCombo`: 実行に必要なコンボ条件。ない場合もある。

### Buff Object
- `name`：バフ名
- `type`："バフ","デバフ"
- `target` ：コマンドに影響するバフ・デバフの場合、"判定"か"ダメージ"かを指定する。
- `command`：コマンドに影響するバフ・デバフの場合、"+1"など、BCdice用のコマンド生成時に付与する
- `limit`：消費されなくても終了するタイミング。ターン終了時、フェーズ

## 5. 実装したい機能（マクロロジック）のイメージ
- バフ・デバフを個人ライブラリに登録
- 特性・独自リソースを個人ライブラリに登録
- アビリティを個人ライブラリに登録
- 使用条件を満たしていないアビリティは暗く表示される

### アビリティ使用イメージ
- 1. ボタン押下 → コスト・条件チェック（足りなければエラー）
- 2-1. コピペ用テキストにBCdice用コマンドを出力（あれば）
- 2-2. コマンドに影響するバフなどがあればコマンドに組み込む
- 2-3. 生成するコマンドは、判定ならば"d20+{mainSrat}+{バフの効果} アビリティ名 バフの効果で指定されているテキスト"、ダメージならば"{damage}+{damageDH}+{バフの効果} アビリティ名 バフの効果で指定されているテキスト"
- 3-1. アクション実行時に付与するバフなどが設定されていれば、付与する。
- 3-2. リソースを増減する効果があれば、増減する。

## 6. 各アビリティのふるまいのイメージ
- 各セクションの「+」ボタンを押すと「アビリティ登録」モーダルが開く
- この時、押したセクションの種類によってメイン、サブなどのタイプが自動的に選択される。
- 各フォームに必要な情報を入力し、登録する。
- 最低限必須な要素は「アビリティ名」「タグ」「基本効果」。アイコンを設定しなかった場合、セクションヘッダーと同じ色の正方形がデフォルトで登録される。
- 入力した要素によってツールチップに表示される内容や、クリックされたときの挙動が決まる。
- 登録されたアビリティはアイコンのみでability-areaに配置される。
- ability-areaは縦2行、横6列からなり、１マスの大きさはアビリティと同じ。
- ability-areaはユーザーが任意で行を追加することができる。削除するときにその行にアビリティが存在する場合、エラーを返す。
- ability-area内のアビリティは所属するセクション内で任意にドラッグアンドドロップで並べ替えが可能で、自動的に左詰めや上詰めはしない。好きに配置できる。ただし同じマスに複数のアビリティは配置できない。
- ability-areaには通常の行とは別に、「その他」行を追加できる。
- 「その他」はセクションの子要素で、通常のability-areaの下に配置される。
- 機能は通常のability-areaと変わらず、ユーザーが視覚的に区別するために使う。
- 「その他」にはタイトルが設定できる。
- 使用条件を満たしていないアビリティは少し暗く表示され、クリックすると満たしていない条件をエラーとして表示する。
- 使用条件のうち、特定のバフや特性リソースによる条件を満たして使用可能になっている場合、ability__proc-lineを表示する。
- アビリティを右クリックするとコンテキストメニューが表示され、再編集や削除ができる。

### アビリティ種別「その他」
- アビリティ種別には「その他」も存在し、メインアクションセクションの上に位置する。
- リミットブレイクも「その他」に含まれる。